<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹åŠ¨å®ç°èŠ‚æµ</title>
</head>
<body>
    <h1>æ‰‹åŠ¨å®ç°èŠ‚æµ</h1>
    <p>æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹æµ‹è¯•ç»“æœ</p>
</body>
<script>

    /**
     * ä»€ä¹ˆæ˜¯èŠ‚æµï¼Ÿ
     * 
     * ç®€å•ç†è§£ï¼šå°±åƒæ¸¸æˆæŠ€èƒ½æœ‰å†·å´æ—¶é—´ï¼Œæ— è®ºä½ æŒ‰å¤šå°‘æ¬¡æŠ€èƒ½é”®ï¼ŒæŠ€èƒ½åªä¼šæŒ‰å›ºå®šæ—¶é—´é—´éš”é‡Šæ”¾
     * 
     * ä¸¾ä¸ªä¾‹å­ï¼š
     * - ä½ ç–¯ç‹‚ç‚¹å‡»æŒ‰é’®ï¼Œä½†æŒ‰é’®æ¯ç§’æœ€å¤šåªèƒ½æ‰§è¡Œ1æ¬¡
     * - ä½ å¿«é€Ÿæ»šåŠ¨é¡µé¢ï¼Œä½†æ»šåŠ¨äº‹ä»¶æ¯200msæœ€å¤šåªè§¦å‘1æ¬¡
     * 
     * èŠ‚æµ VS é˜²æŠ–ï¼š
     * - é˜²æŠ–ï¼šç­‰ä½ åœä¸‹æ¥å†æ‰§è¡Œï¼ˆåƒç”µæ¢¯é—¨ï¼Œæœ‰äººæŒ‰å°±é‡æ–°è®¡æ—¶ï¼‰
     * - èŠ‚æµï¼šæŒ‰å›ºå®šé¢‘ç‡æ‰§è¡Œï¼ˆåƒæŠ€èƒ½CDï¼Œåˆ°æ—¶é—´å°±èƒ½ç”¨ï¼‰
     */

    /**
     * èŠ‚æµçš„åº”ç”¨åœºæ™¯ï¼š
     * 1. é¡µé¢æ»šåŠ¨ - æ»šåŠ¨æ—¶ä¸æ–­è§¦å‘ï¼Œä½†æˆ‘ä»¬åªéœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥ä¸€æ¬¡ä½ç½®
     * 2. é¼ æ ‡ç§»åŠ¨ - é¼ æ ‡ç§»åŠ¨é¢‘ç‡å¾ˆé«˜ï¼Œä½†æ›´æ–°UIä¸éœ€è¦é‚£ä¹ˆé¢‘ç¹
     * 3. çª—å£ç¼©æ”¾ - æ‹–æ‹½çª—å£æ—¶ä¼šä¸æ–­è§¦å‘resizeï¼Œä½†é‡æ–°è®¡ç®—å¸ƒå±€ä¸éœ€è¦é‚£ä¹ˆé¢‘ç¹
     * 4. æŒ‰é’®ç‚¹å‡» - é˜²æ­¢ç”¨æˆ·ç–¯ç‹‚ç‚¹å‡»æäº¤æŒ‰é’®
     */

    // ========== æ–¹æ³•1ï¼šæœ€ç®€å•çš„èŠ‚æµå®ç° ==========
    
    /**
     * ç®€å•ç‰ˆèŠ‚æµå‡½æ•°
     * @param {Function} func - è¦èŠ‚æµçš„å‡½æ•°
     * @param {number} delay - æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰
     */
    function simpleThrottle(func, delay) {
        let lastTime = 0; // è®°å½•ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
        let result; // ä¿å­˜å‡½æ•°è¿”å›å€¼
        
        return function(...args) {
            const now = Date.now(); // å½“å‰æ—¶é—´
            
            // å¦‚æœè·ç¦»ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è®¾å®šçš„é—´éš”ï¼Œå°±æ‰§è¡Œå‡½æ•°
            if (now - lastTime >= delay) {
                lastTime = now; // æ›´æ–°æ‰§è¡Œæ—¶é—´
                result = func.apply(this, args); // æ‰§è¡ŒåŸå‡½æ•°å¹¶ä¿å­˜è¿”å›å€¼
            }
            return result; // è¿”å›æœ€è¿‘ä¸€æ¬¡çš„æ‰§è¡Œç»“æœ
        };
    }
    // ä¸Šè¾¹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ–¹æ³•
    const throttledFunc = simpleThrottle(function() {
        console.log('èŠ‚æµå‡½æ•°1');
    }, 1000);
    
    console.log('=== ç®€å•èŠ‚æµæµ‹è¯• ===');
    console.log('è¿ç»­è°ƒç”¨3æ¬¡ï¼Œä½†åªæ‰§è¡Œ1æ¬¡ï¼ˆå› ä¸ºé—´éš”æ˜¯1000msï¼‰ï¼š');
    throttledFunc(); // ç¬¬1æ¬¡è°ƒç”¨ - ç«‹å³æ‰§è¡Œ
    throttledFunc(); // ç¬¬2æ¬¡è°ƒç”¨ - è¢«èŠ‚æµï¼Œä¸æ‰§è¡Œ
    throttledFunc(); // ç¬¬3æ¬¡è°ƒç”¨ - è¢«èŠ‚æµï¼Œä¸æ‰§è¡Œ
    
    // æ¼”ç¤º1ç§’åå†æ¬¡è°ƒç”¨
    setTimeout(() => {
        console.log('1ç§’åå†æ¬¡è°ƒç”¨ï¼š');
        throttledFunc(); // è¿™æ¬¡ä¼šæ‰§è¡Œï¼Œå› ä¸ºè·ç¦»ä¸Šæ¬¡æ‰§è¡Œå·²ç»è¶…è¿‡1000ms
    }, 1000);
    
    // æ¼”ç¤ºæ›´é¢‘ç¹çš„è°ƒç”¨
    console.log('\n=== é¢‘ç¹è°ƒç”¨æ¼”ç¤º ===');
    const frequentThrottle = simpleThrottle(function(msg) {
        console.log(`æ‰§è¡Œ: ${msg}`);
    }, 500); // 500msé—´éš”
    
    console.log('æ¯100msè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒç»­1ç§’ï¼š');
    for (let i = 1; i <= 10; i++) {
        setTimeout(() => {
            frequentThrottle(`ç¬¬${i}æ¬¡è°ƒç”¨`);
        }, i * 100);
    }
    
    // ========== æ–¹æ³•2ï¼šå®Œæ•´ç‰ˆèŠ‚æµå®ç° ==========
    
    /**
     * å®Œæ•´ç‰ˆèŠ‚æµå‡½æ•° - æ”¯æŒæ‰€æœ‰è¦æ±‚
     * @param {Function} func - è¦èŠ‚æµçš„å‡½æ•°
     * @param {number} delay - æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰
     * @param {Object} options - é…ç½®é€‰é¡¹
     * @param {boolean} options.leading - æ˜¯å¦ç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡ï¼ˆé»˜è®¤trueï¼‰
     * @param {boolean} options.trailing - æ˜¯å¦åœ¨é—´éš”ç»“æŸåæ‰§è¡Œæœ€åä¸€æ¬¡ï¼ˆé»˜è®¤trueï¼‰
     */
    function throttle(func, delay, options = {}) {
        // è®¾ç½®é»˜è®¤é€‰é¡¹
        const { leading = true, trailing = true } = options;
        
        let timer = null;        // å®šæ—¶å™¨
        let lastTime = 0;       // ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
        let lastArgs = null;    // æœ€åä¸€æ¬¡è°ƒç”¨çš„å‚æ•°
        let lastThis = null;    // æœ€åä¸€æ¬¡è°ƒç”¨çš„this
        let result;             // å‡½æ•°è¿”å›å€¼
        
        // å»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆç”¨äºtrailingæ¨¡å¼ï¼‰
        function runLater() {
            lastTime = leading === false ? 0 : Date.now();
            timer = null;
            if (lastArgs) {
                result = func.apply(lastThis, lastArgs);
                lastArgs = null;
                lastThis = null;
            }
        }
        
        return function(...args) {
            const now = Date.now();
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸”ä¸éœ€è¦ç«‹å³æ‰§è¡Œï¼Œè®°å½•å½“å‰æ—¶é—´
            if (!lastTime && leading === false) {
                lastTime = now;
            }
            
            // è®¡ç®—è¿˜éœ€è¦ç­‰å¾…å¤šé•¿æ—¶é—´
            const remaining = delay - (now - lastTime);
            
            if (remaining <= 0 || remaining > delay) {
                // æ—¶é—´åˆ°äº†ï¼Œç«‹å³æ‰§è¡Œ
                if (timer) {
                    clearTimeout(timer);
                    timer = null;
                }
                lastTime = now;
                result = func.apply(this, args); // ä¿å­˜è¿”å›å€¼
            } else if (!timer && trailing) {
                // è¿˜æ²¡åˆ°æ—¶é—´ï¼Œä½†éœ€è¦åœ¨é—´éš”ç»“æŸåæ‰§è¡Œæœ€åä¸€æ¬¡
                lastArgs = args;
                lastThis = this;
                timer = setTimeout(runLater, remaining);
            }
            
            return result; // å§‹ç»ˆè¿”å›æœ€è¿‘ä¸€æ¬¡çš„æ‰§è¡Œç»“æœ
        };
    }
    // è°ƒç”¨ä¸Šè¿°å‡½æ•°ï¼ŒéªŒè¯optionså‚æ•°
    const throttledFunc2 = throttle(function() {
        console.log('èŠ‚æµå‡½æ•°2');
    }, 1000, { leading: false, trailing: false });
    throttledFunc2();
    throttledFunc2();

    // ========== å®é™…åº”ç”¨ç¤ºä¾‹ ==========
    
    setTimeout(() => {
        console.log('\n=== å®é™…åº”ç”¨ç¤ºä¾‹ ===');
        
        // 1. æœç´¢æ¡†è¾“å…¥èŠ‚æµ
        const searchThrottle = throttle((keyword) => {
            console.log(`ğŸ” æœç´¢: ${keyword}`);
            // æ¨¡æ‹Ÿæœç´¢ç»“æœ
            return `æ‰¾åˆ°${Math.floor(Math.random() * 100)}ä¸ªç»“æœ`;
        }, 300);
        
        // 2. çª—å£å¤§å°è°ƒæ•´èŠ‚æµ
        const resizeThrottle = throttle((width, height) => {
            console.log(`ğŸ“ çª—å£è°ƒæ•´: ${width}x${height}`);
            // æ¨¡æ‹Ÿå¸ƒå±€é‡æ–°è®¡ç®—
            return `å¸ƒå±€å·²æ›´æ–°`;
        }, 250);
        
        // 3. é¼ æ ‡ç§»åŠ¨èŠ‚æµ
        const mouseMoveThrottle = throttle((x, y) => {
            console.log(`ğŸ–±ï¸ é¼ æ ‡ä½ç½®: (${x}, ${y})`);
            // æ¨¡æ‹Ÿé¼ æ ‡è·Ÿéšæ•ˆæœ
            return `ä½ç½®å·²æ›´æ–°`;
        }, 16); // çº¦60fps
        
        // 4. æ»šåŠ¨äº‹ä»¶èŠ‚æµ
        const scrollThrottle = throttle((scrollTop) => {
            console.log(`ğŸ“œ æ»šåŠ¨ä½ç½®: ${scrollTop}px`);
            // æ¨¡æ‹Ÿæ‡’åŠ è½½æ£€æŸ¥
            return scrollTop > 500 ? 'è§¦å‘æ‡’åŠ è½½' : 'ç»§ç»­æ»šåŠ¨';
        }, 100);
        
        console.log('ä»¥ä¸Šæ˜¯å¸¸è§çš„èŠ‚æµåº”ç”¨åœºæ™¯ï¼Œéƒ½æ”¯æŒè¿”å›å€¼');
        
        // æ¼”ç¤ºè¿”å›å€¼åŠŸèƒ½
        console.log('\næ¼”ç¤ºè¿”å›å€¼åŠŸèƒ½ï¼š');
        const searchResult = searchThrottle('JavaScript');
        console.log(`æœç´¢ç»“æœ: ${searchResult}`);
        
        const resizeResult = resizeThrottle(1920, 1080);
        console.log(`è°ƒæ•´ç»“æœ: ${resizeResult}`);
        
    }, 8000);

    // ========== å·¥å…·å‡½æ•° ==========
    
    /**
     * åˆ›å»ºä¸€ä¸ªå¸¦å–æ¶ˆåŠŸèƒ½çš„èŠ‚æµå‡½æ•°
     */
    function createCancelableThrottle(func, delay) {
        let timer = null;
        let lastTime = 0;
        let result;
        
        function throttled(...args) {
            const now = Date.now();
            if (now - lastTime >= delay) {
                lastTime = now;
                result = func.apply(this, args);
            }
            return result;
        }
        
        // æ·»åŠ å–æ¶ˆæ–¹æ³•
        throttled.cancel = function() {
            if (timer) {
                clearTimeout(timer);
                timer = null;
            }
            lastTime = 0;
            result = undefined;
        };
        
        return throttled;
    }
</script>
</html>